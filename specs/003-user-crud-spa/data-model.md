# Data Model: User CRUD Single-Page Application

**Feature**: 003-user-crud-spa
**Date**: 2026-02-05

## Overview

This document describes the data model for the User CRUD SPA. The frontend only interacts with User entities via the backend REST API. The backend data model (User, Role, and their relationship) is documented for context.

## Frontend Model

### User (TypeScript Interface)

The frontend represents users with this TypeScript interface:

```typescript
// frontend/src/app/user.model.ts
export interface User {
  id: number;
  name: string;
  email: string;
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| id | number | Yes (read-only) | Auto-generated by backend |
| name | string | Yes | User's display name |
| email | string | Yes | User's email address |

**Notes**:
- `id` is assigned by the backend on creation (not sent in POST/PUT body)
- Frontend validates that `name` and `email` are non-empty before submission
- Backend performs additional validation (returns 400 if invalid)

## Backend Model (Existing)

The backend has two JPA entities with a many-to-many relationship:

### User Entity

```java
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @NotBlank
    private String name;

    @NotBlank
    private String email;

    @ManyToMany
    @JoinTable(
        name = "user_roles",
        joinColumns = @JoinColumn(name = "user_id"),
        inverseJoinColumns = @JoinColumn(name = "role_id")
    )
    @JsonIgnore
    private Set<Role> roles = new HashSet<>();
}
```

### Role Entity

```java
@Entity
@Table(name = "roles")
public class Role {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(unique = true)
    private String name;

    @ManyToMany(mappedBy = "roles")
    @JsonIgnore
    private Set<User> users = new HashSet<>();
}
```

### Relationship: User ↔ Role

- **Type**: Many-to-Many
- **Owner**: User (owns the `user_roles` join table)
- **Join Table**: `user_roles` with columns `user_id` and `role_id`
- **JSON Serialization**: `@JsonIgnore` on both sides prevents circular references

**Note**: The frontend does NOT interact with Role entities. The `@JsonIgnore` annotation means roles are not included in User JSON responses.

## Database Schema

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│     users       │     │   user_roles    │     │     roles       │
├─────────────────┤     ├─────────────────┤     ├─────────────────┤
│ id (PK)         │────<│ user_id (FK)    │>────│ id (PK)         │
│ name            │     │ role_id (FK)    │     │ name (UNIQUE)   │
│ email           │     └─────────────────┘     └─────────────────┘
└─────────────────┘
```

## API Data Transfer

### List Users Response (GET /users)

```json
[
  { "id": 1, "name": "Alice", "email": "alice@example.com" },
  { "id": 2, "name": "Bob", "email": "bob@example.com" }
]
```

### Single User Response (GET /users/{id}, POST /users, PUT /users/{id})

```json
{ "id": 1, "name": "Alice", "email": "alice@example.com" }
```

### Create User Request (POST /users)

```json
{ "name": "Alice", "email": "alice@example.com" }
```

### Update User Request (PUT /users/{id})

```json
{ "name": "Alice Updated", "email": "alice.new@example.com" }
```

**Note**: The `id` field is never sent in request bodies. It's determined by:
- Path parameter for GET/PUT/DELETE
- Auto-generated by database for POST

## Validation Rules

### Frontend Validation (before API call)

| Field | Rule | Error Message |
|-------|------|---------------|
| name | Must not be empty | "Name is required" |
| email | Must not be empty | "Email is required" |

### Backend Validation (returns 400 Bad Request)

| Field | Rule | Annotation |
|-------|------|------------|
| name | Must not be blank | @NotBlank |
| email | Must not be blank | @NotBlank |

## State Transitions

Users have no explicit state field. The lifecycle is:

```
[Not Exists] --POST /users--> [Exists] --PUT /users/{id}--> [Updated]
                                 |
                                 +--DELETE /users/{id}--> [Not Exists]
```

## Scope Exclusions

The following data concerns are explicitly out of scope:

- Role management (no frontend interaction with roles)
- User-Role assignment (managed separately, not in this feature)
- Password/authentication fields
- Audit fields (createdAt, updatedAt)
- Soft delete (deleted flag)

# Data Model: Role CRUD API

**Date**: 2026-02-05

## Entities

### User (Modified)

| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| id | Long | Primary key, auto-generated | Unique identifier |
| name | String | Required, non-empty | User's name |
| email | String | Required, non-empty | User's email address |
| roles | Set<Role> | Many-to-many relationship | Roles assigned to this user |

**Changes from existing**:
- Added `roles` field with `@ManyToMany` relationship
- User owns the relationship (join table managed from User side)

### Role (New)

| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| id | Long | Primary key, auto-generated | Unique identifier |
| name | String | Required, non-empty, unique | Role name |
| users | Set<User> | Many-to-many relationship (mapped by User) | Users with this role |

**Notes**:
- Name uniqueness enforced at database level via unique constraint
- Role is the inverse side of the relationship (mappedBy = "roles")

### Join Table: user_roles (Auto-generated)

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| user_id | Long | Foreign key to users.id | User reference |
| role_id | Long | Foreign key to roles.id | Role reference |

**Notes**:
- Primary key: composite (user_id, role_id)
- Auto-generated by Hibernate from @ManyToMany annotation
- Cascade: User deletion removes assignments; Role cannot be deleted if assigned

## Relationships

```
User ←──────────────→ Role
     many-to-many
     (via user_roles)
```

- A User can have zero or more Roles
- A Role can be assigned to zero or more Users
- Role deletion blocked if assigned to any User (409 Conflict)
- User deletion cascades to remove all role assignments

## Database Schema

```sql
-- Existing table (no changes)
CREATE TABLE users (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL
);

-- New table
CREATE TABLE roles (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE
);

-- New join table (auto-generated by Hibernate)
CREATE TABLE user_roles (
    user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    role_id BIGINT NOT NULL REFERENCES roles(id),
    PRIMARY KEY (user_id, role_id)
);
```

**Note**: Schema auto-generated by Hibernate (spring.jpa.hibernate.ddl-auto=update).

# Data Model: User CRUD API

**Date**: 2026-02-05

## Entities

### User

| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| id | Long | Primary key, auto-generated | Unique identifier |
| name | String | Required, non-empty | User's name |
| email | String | Required, non-empty | User's email address |

**Notes**:
- No email format validation (any non-empty string accepted)
- No uniqueness constraint on email
- ID auto-generated by database (sequence/identity)

## PlantUML Diagrams

### Data Model (Class Diagram)

```plantuml
@startuml
skinparam classAttributeIconSize 0

class User {
  - id : Long
  - name : String
  - email : String
  + getId() : Long
  + getName() : String
  + getEmail() : String
  + setName(name : String) : void
  + setEmail(email : String) : void
}

note right of User
  JPA Entity
  @Entity
  @Table(name = "users")

  id: @Id @GeneratedValue
  name: @NotBlank
  email: @NotBlank
end note

@enduml
```

### Use Case Diagram

```plantuml
@startuml
skinparam actorStyle awesome

actor "API Client" as client

rectangle "User CRUD API" {
  usecase "Create User" as UC1
  usecase "List All Users" as UC2
  usecase "Get User by ID" as UC3
  usecase "Update User" as UC4
  usecase "Delete User" as UC5
}

client --> UC1 : POST /users
client --> UC2 : GET /users
client --> UC3 : GET /users/{id}
client --> UC4 : PUT /users/{id}
client --> UC5 : DELETE /users/{id}

@enduml
```

### Sequence Diagram: POST /users (Create User)

```plantuml
@startuml
skinparam sequenceMessageAlign center

actor "API Client" as client
participant "UserController" as controller
participant "UserRepository" as repo
database "PostgreSQL" as db

client -> controller : POST /users\n{name, email}
activate controller

alt name or email missing/empty
  controller --> client : 400 Bad Request\n{error details}
else valid request
  controller -> repo : save(user)
  activate repo
  repo -> db : INSERT INTO users
  activate db
  db --> repo : generated id
  deactivate db
  repo --> controller : saved User
  deactivate repo
  controller --> client : 201 Created\n{id, name, email}
end

deactivate controller

@enduml
```

### Sequence Diagram: GET /users (List All Users)

```plantuml
@startuml
skinparam sequenceMessageAlign center

actor "API Client" as client
participant "UserController" as controller
participant "UserRepository" as repo
database "PostgreSQL" as db

client -> controller : GET /users
activate controller

controller -> repo : findAll()
activate repo
repo -> db : SELECT * FROM users
activate db
db --> repo : rows
deactivate db
repo --> controller : List<User>
deactivate repo

controller --> client : 200 OK\n[{id, name, email}, ...]
deactivate controller

@enduml
```

### Sequence Diagram: GET /users/{id} (Get User by ID)

```plantuml
@startuml
skinparam sequenceMessageAlign center

actor "API Client" as client
participant "UserController" as controller
participant "UserRepository" as repo
database "PostgreSQL" as db

client -> controller : GET /users/{id}
activate controller

controller -> repo : findById(id)
activate repo
repo -> db : SELECT * FROM users\nWHERE id = ?
activate db
db --> repo : row or empty
deactivate db
repo --> controller : Optional<User>
deactivate repo

alt user not found
  controller --> client : 404 Not Found\n{error details}
else user found
  controller --> client : 200 OK\n{id, name, email}
end

deactivate controller

@enduml
```

### Sequence Diagram: PUT /users/{id} (Update User)

```plantuml
@startuml
skinparam sequenceMessageAlign center

actor "API Client" as client
participant "UserController" as controller
participant "UserRepository" as repo
database "PostgreSQL" as db

client -> controller : PUT /users/{id}\n{name, email}
activate controller

controller -> repo : findById(id)
activate repo
repo -> db : SELECT * FROM users\nWHERE id = ?
activate db
db --> repo : row or empty
deactivate db
repo --> controller : Optional<User>
deactivate repo

alt user not found
  controller --> client : 404 Not Found\n{error details}
else user found
  controller -> controller : update fields\n(if provided)
  controller -> repo : save(user)
  activate repo
  repo -> db : UPDATE users\nSET name=?, email=?\nWHERE id=?
  activate db
  db --> repo : updated
  deactivate db
  repo --> controller : updated User
  deactivate repo
  controller --> client : 200 OK\n{id, name, email}
end

deactivate controller

@enduml
```

### Sequence Diagram: DELETE /users/{id} (Delete User)

```plantuml
@startuml
skinparam sequenceMessageAlign center

actor "API Client" as client
participant "UserController" as controller
participant "UserRepository" as repo
database "PostgreSQL" as db

client -> controller : DELETE /users/{id}
activate controller

controller -> repo : existsById(id)
activate repo
repo -> db : SELECT COUNT(*)\nFROM users WHERE id = ?
activate db
db --> repo : count
deactivate db
repo --> controller : boolean
deactivate repo

alt user not found
  controller --> client : 404 Not Found\n{error details}
else user found
  controller -> repo : deleteById(id)
  activate repo
  repo -> db : DELETE FROM users\nWHERE id = ?
  activate db
  db --> repo : deleted
  deactivate db
  repo --> controller : void
  deactivate repo
  controller --> client : 204 No Content
end

deactivate controller

@enduml
```

## Database Schema

```sql
CREATE TABLE users (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL
);
```

**Note**: Schema auto-generated by Hibernate (spring.jpa.hibernate.ddl-auto=update).
